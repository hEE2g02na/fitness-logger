<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href="manifest.json" rel="manifest"/>
    <meta content="#4CAF50" name="theme-color"/>
    <link href="style.css" rel="stylesheet"/>
    <title>Fitness Logger</title>
    <style>
        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }
    </style>
</head>
<body class="has-bottomnav">
<div id="syncStatus" title="Shows your sync/connection status">
    <progress id="syncProgressBar" max="100" style="width:120px;vertical-align:middle;" value="0"></progress>
    <span id="syncStatusLabel">üîÑ Syncing...</span>
</div>
<h1>Fitness Logger</h1>

<!-- Move navbar here, above all .tab elements -->
<div class="navbar-container">
    <nav aria-label="Main Navigation" id="navbar" role="tablist">
        <button aria-current="page" aria-label="Log" data-tab="log" title="Go to Log tab">
            <span class="nav-icon">üèãÔ∏è</span>
            <span class="nav-label">Log</span>
        </button>
        <button aria-label="Summary" data-tab="summary" title="Go to Summary tab">
            <span class="nav-icon">üìä</span>
            <span class="nav-label">Summary</span>
        </button>
        <button aria-label="Performance" data-tab="performance" title="Go to Performance tab">
            <span class="nav-icon">üìà</span>
            <span class="nav-label">Performance</span>
        </button>
        <button aria-label="Settings" data-tab="settings" title="Go to Settings tab">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">Settings</span>
        </button>
        <button aria-label="Diagnostics" data-tab="diagnostics" title="Go to Diagnostics tab">
            <span class="nav-icon">üõ†Ô∏è</span>
            <span class="nav-label">Diagnostics</span>
        </button>
        <button aria-label="Appearance" data-tab="preferences" title="Go to Appearance tab">
            <span class="nav-icon">üé®</span>
            <span class="nav-label">Appearance</span>
        </button>
    </nav>
</div>

<!-- üèãÔ∏è LOG TAB -->
<div class="tab active" data-tab="log">
    <form id="entryForm">
        <input id="date" required title="Date of workout" type="date"/>
        <input autocomplete="off" id="exercise" list="exerciseSuggestions" placeholder="Exercise" required
               title="Type exercise name"
               type="text"/>
        <datalist id="exerciseSuggestions"></datalist>
        <input id="sets" placeholder="Sets" required title="Number of sets" type="number"/>
        <input id="reps" placeholder="Reps" required title="Number of reps per set" type="number"/>
        <input id="weight" placeholder="Weight (lbs)" title="Weight used (in pounds)" type="number"/>
        <select id="category" title="Workout category">
            <option value="Strength">Strength</option>
            <option value="Cardio">Cardio</option>
            <option value="Flexibility">Flexibility</option>
        </select>
        <input id="tags" placeholder="Tags (comma separated, e.g. push,core)" title="Add tags for smarter sorting"
               type="text"/>
        <button title="Add workout entry" type="submit">Add Entry</button>
        <button id="addCircuitBtn" title="Add a circuit of exercises" type="button">Add Circuit</button>
    </form>

    <!-- Circuit Builder Section -->
    <section id="circuitBuilder"
             style="display:none; margin-top:1rem; background:#f8f8f8; border:1px solid #ddd; border-radius:8px; padding:1em 1.5em;">
        <h4 style="margin-top:0;">Add Circuit</h4>
        <div style="color:#666; font-size:0.98em; margin-bottom:0.7em;">
            Build a circuit by adding multiple exercises. Fill out each row, then save the circuit as a single workout
            entry.
        </div>
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; margin-bottom:0.5em;">
                <thead>
                <tr style="background:#eee;">
                    <th style="padding:0.3em 0.5em;">Exercise</th>
                    <th style="padding:0.3em 0.5em;">Sets</th>
                    <th style="padding:0.3em 0.5em;">Reps</th>
                    <th style="padding:0.3em 0.5em;">Weight</th>
                    <th style="padding:0.3em 0.5em;">Category</th>
                    <th style="padding:0.3em 0.5em;">Tags</th>
                    <th style="padding:0.3em 0.5em;">Remove</th>
                </tr>
                </thead>
                <tbody id="circuitExercises">
                <!-- JS will fill rows here -->
                </tbody>
            </table>
        </div>
        <div style="display:flex; gap:0.5em; flex-wrap:wrap;">
            <button id="addExerciseToCircuitBtn" title="Add exercise to circuit" type="button">Add Exercise to Circuit
            </button>
            <button id="saveCircuitBtn" style="background:#4CAF50; color:#fff;" title="Save circuit" type="button">Save
                Circuit
            </button>
            <button id="cancelCircuitBtn" style="background:#eee;" title="Cancel circuit" type="button">Cancel</button>
        </div>
    </section>

    <section id="filters">
        <input id="filterExercise" placeholder="Filter by Exercise" title="Filter logs by exercise" type="text"/>
        <input id="filterDate" title="Filter logs by date" type="date"/>
        <select id="filterCategory" title="Filter logs by category">
            <option value="">All</option>
            <option value="Strength">Strength</option>
            <option value="Cardio">Cardio</option>
            <option value="Flexibility">Flexibility</option>
        </select>
        <input id="filterTags" placeholder="Filter by Tag" title="Filter logs by tag" type="text"/>
    </section>

    <ul id="logList"></ul>
</div>

<!-- üìä SUMMARY TAB -->
<div class="tab" data-tab="summary">
    <h3>Weekly Summary</h3>
    <div id="streakTracker" title="Your current workout streak"></div>
    <p id="weeklySummary"></p>
    <canvas data-chart="chart" height="200" id="chart" title="Bar chart of recent workouts" width="400"></canvas>
    <table id="summaryTable" style="margin-top:1em; width:100%; border-collapse:collapse;">
        <thead>
        <tr>
            <th>Date</th>
            <th>Exercise</th>
            <th>Sets</th>
            <th>Reps</th>
            <th>Weight</th>
            <th>Volume</th>
        </tr>
        </thead>
        <tbody>
        <!-- Filled by JS -->
        </tbody>
    </table>
</div>

<!-- üìà PERFORMANCE TAB -->
<div class="tab" data-tab="performance">
    <h2>Performance Overview</h2>
    <section id="performanceSummary">
        <p>Loading performance data...</p>
    </section>
    <section id="personalRecords">
        <h3>üèÖ Personal Records History</h3>
        <ul id="prList"></ul>
    </section>
    <div data-chart="exerciseCharts" id="exerciseCharts" title="Separate charts for your top exercises"></div>
</div>

<!-- ‚öôÔ∏è SETTINGS TAB -->
<div class="tab" data-tab="settings">
    <h2>Settings</h2>
    <button id="toggleTheme" title="Switch between light and dark mode">Toggle Dark/Light Theme</button>
    <!-- Sample Data Button will be injected here by JS -->
    <section id="goalSetting">
        <h3>üéØ Set Your Goals</h3>
        <div class="settings-desc">Set daily or weekly targets to stay motivated. Progress is shown on the summary
            tab.
        </div>
        <form id="goalForm">
            <label title="Target total weight lifted per day">
                Daily Volume Target (lbs):
                <input id="goalVolume" min="0" title="Set your daily volume target" type="number"/>
            </label>
            <label title="Target number of sets per day">
                Daily Sets Target:
                <input id="goalSets" min="0" title="Set your daily sets target" type="number"/>
            </label>
            <label title="Target number of sessions per day">
                Daily Sessions Target:
                <input id="goalSessions" min="0" title="Set your daily sessions target" type="number"/>
            </label>
            <label title="Target total weight lifted per week">
                Weekly Volume Target (lbs):
                <input id="goalWeeklyVolume" min="0" title="Set your weekly volume target" type="number"/>
            </label>
            <button title="Save your goals" type="submit">Save Goals</button>
        </form>
        <div id="goalStatus"></div>
    </section>
    <div id="sampleButtons" style="margin:1em 0; display:flex; flex-wrap:wrap; gap:0.5em;">
        <!-- Buttons injected by JS -->
    </div>
    <section id="exportOptions" style="margin:1.5em 0;">
        <h3 style="margin-bottom:0.5em;">Export Options</h3>
        <button id="exportJSON" title="Export your logs as a JSON file">Export JSON</button>
        <button id="exportCSV" title="Export your logs as a CSV file">Export CSV</button>
        <button id="exportPNG" title="Export main chart as PNG">Export Chart as PNG</button>
        <button id="exportPDF" title="Export logs as PDF">Export PDF</button>
        <button id="exportExcel" title="Export logs as Excel">Export Excel</button>
    </section>
</div>

<!-- üõ†Ô∏è DIAGNOSTICS TAB -->
<div class="tab" data-tab="diagnostics">
    <h2>Diagnostics & Tools</h2>
    <div id="diagnosticsTools">
        <button id="diagTestConnection">Test Firestore Connection</button>
        <button id="diagShowLocalStorage">Show Local Storage</button>
        <button id="diagClearLocalStorage">Clear Local Storage</button>
        <button id="diagShowLogsCount">Show Log Count</button>
        <button id="diagReload">Reload App</button>
        <!-- New tools -->
        <button id="diagShowUserAgent">Show User Agent</button>
        <button id="diagShowScreenSize">Show Screen Size</button>
        <button id="diagShowAppVersion">Show App Version</button>
    </div>
    <div id="diagnosticsOutput"
         style="margin-top:1em; white-space:pre-wrap; background:#f8f8f8; border:1px solid #ccc; border-radius:6px; padding:1em; min-height:3em;"></div>
</div>

<!-- ‚öôÔ∏è PREFERENCES TAB -->
<div class="tab" data-tab="preferences">
    <h2>Appearance</h2>
    <form id="preferencesForm" style="max-width:400px;">
        <fieldset style="border:none; border-bottom:1px solid #ddd; margin-bottom:1.5em; padding-bottom:1em;">
            <legend style="font-weight:bold; color:#4CAF50; margin-bottom:0.5em;">Theme & Layout</legend>
            <label style="display:block; margin-bottom:1em;">
                Theme:
                <select id="prefTheme">
                    <option value="system">System Default</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                </select>
            </label>
            <label style="display:block; margin-bottom:1em;">
                Font Size:
                <select id="prefFontSize">
                    <option value="normal">Normal</option>
                    <option value="large">Large</option>
                    <option value="xlarge">Extra Large</option>
                </select>
            </label>
            <label style="display:block; margin-bottom:1em;">
                Font Family:
                <select id="prefFontFamily">
                    <option value="">Default</option>
                    <option value="system-ui">System UI</option>
                    <option value="serif">Serif</option>
                    <option value="monospace">Monospace</option>
                    <option value="Arial, sans-serif">Arial</option>
                    <option value="Georgia, serif">Georgia</option>
                    <option value="Courier New, monospace">Courier New</option>
                </select>
            </label>
            <label style="display:block; margin-bottom:1em;">
                Border Radius:
                <input id="prefBorderRadius" max="32" min="0" step="1" style="width:120px;vertical-align:middle;"
                       type="range"
                       value="8"/>
                <span id="borderRadiusValue" style="margin-left:0.5em;">8px</span>
            </label>
            <label style="display:block; margin-bottom:1em;">
                Shadow:
                <input id="prefShadow" max="32" min="0" step="1" style="width:120px;vertical-align:middle;" type="range"
                       value="8"/>
                <span id="shadowValue" style="margin-left:0.5em;">8px</span>
            </label>
            <label style="display:block; margin-bottom:1em;">
                Transition:
                <input id="prefTransition" max="1" min="0" step="0.05" style="width:120px;vertical-align:middle;"
                       type="range"
                       value="0.25"/>
                <span id="transitionValue" style="margin-left:0.5em;">0.25s</span>
            </label>
            <label style="display:block; margin-bottom:1em;">
                <input id="prefRounded" type="checkbox"/>
                Rounded Corners
            </label>
            <label style="display:block; margin-bottom:1em;">
                <input id="prefCompact" type="checkbox"/>
                Compact Layout
            </label>
            <label style="display:block; margin-bottom:1em;">
                Sidebar Position:
                <select id="prefSidebarPosition">
                    <option value="left">Left</option>
                    <option value="right">Right</option>
                </select>
            </label>
        </fieldset>

        <fieldset style="border:none; border-bottom:1px solid #ddd; margin-bottom:1.5em; padding-bottom:1em;">
            <legend style="font-weight:bold; color:#4CAF50; margin-bottom:0.5em;">Colors</legend>
            <label style="display:block; margin-bottom:1em;">
                Primary Color:
                <input id="prefPrimaryColor" type="color" value="#4CAF50"/>
            </label>
            <label style="display:block; margin-bottom:1em;">
                Accent Color:
                <input id="prefAccentColor" type="color" value="#81c784"/>
            </label>
            <label style="display:block; margin-bottom:1em;">
                Chart Color:
                <input id="prefChartColor" type="color" value="#4CAF50"/>
            </label>
        </fieldset>

        <fieldset style="border:none; border-bottom:1px solid #ddd; margin-bottom:1.5em; padding-bottom:1em;">
            <legend style="font-weight:bold; color:#4CAF50; margin-bottom:0.5em;">Chart Settings</legend>
            <label style="display:block; margin-bottom:1em;">
                Default Chart Type:
                <select id="prefChartType">
                    <option value="bar">Bar</option>
                    <option value="line">Line</option>
                </select>
            </label>
            <label style="display:block; margin-bottom:1em;">
                <input checked id="prefShowGridlines" type="checkbox"/>
                Show Chart Gridlines
            </label>
            <label style="display:block; margin-bottom:1em;">
                <input checked id="prefChartAnimation" type="checkbox"/>
                Chart Animation
            </label>
        </fieldset>

        <fieldset style="border:none; margin-bottom:1.5em; padding-bottom:0;">
            <legend style="font-weight:bold; color:#4CAF50; margin-bottom:0.5em;">Defaults</legend>
            <label style="display:block; margin-bottom:1em;">
                Default Category:
                <select id="prefDefaultCategory">
                    <option value="Strength">Strength</option>
                    <option value="Cardio">Cardio</option>
                    <option value="Flexibility">Flexibility</option>
                </select>
            </label>
        </fieldset>

        <button style="margin-top:1em;" type="submit">Save Appearance</button>
        <div id="preferencesStatus" style="margin-top:0.7em;color:#4CAF50;"></div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="script.js" type="module"></script>
</body>
</html>
